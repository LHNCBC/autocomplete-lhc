
<!DOCTYPE html>
<html lang="en-US">

  <head>
    <!-- Global site tag (gtag.js) - Google Analytics -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=UA-75410768-6"></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());
      gtag('config', 'UA-75410768-6');
    </script>

    <meta charset='utf-8'>
    <meta http-equiv="X-UA-Compatible" content="chrome=1">
    
    <meta name="description" content="Autocomplete-lhc: An autocompleter package used by the NLM PHR and LHC-Forms projects">

    <title>Autocomplete-lhc: Documentation</title>
    <link rel="stylesheet" href="dist/demo.min.css" media="screen">

  </head>

  <body ng-app="demoApp">

    <!-- HEADER -->
    <div id="header_wrap" class="outer">
        <header class="inner">
          <a id="forkme_banner" href="https://github.com/lhncbc/autocomplete-lhc">View on GitHub</a>

          <h1 id="project_title">Autocomplete-lhc</h1>
          <h2 id="project_tagline">An autocompleter package used by the NLM PHR and LHC-Forms projects</h2>
            <div id="header_buttons">
              <a href="index.html#installation">Installation</a>
              <a href="index.html#demos">Demos</a>
              <a href="index.html#features">Features</a>

              <div>Documentation</div>
            </div>
            <section id="downloads">
              <a class="zip_download_link"
               href="https://clin-table-search.lhc.nlm.nih.gov/autocomplete-lhc-versions/"
              >Download pre-built JavaScript and CSS as a .zip file</a>
              <!--<a class="zip_download_link" href="https://github.com/lhncbc/autocomplete-lhc/zipball/master">Download this project as a .zip file</a>
              <a class="tar_download_link" href="https://github.com/lhncbc/autocomplete-lhc/tarball/master">Download this project as a tar.gz file</a>
              -->
            </section>
        </header>
    </div>


    <!-- MAIN CONTENT -->
    <div id="main_content_wrap" class="outer">
      <ul id="toc" class="col">
        <li><a href="#construction">Constructing an autocompleter</a></li>
        <ul>
          <li><a href="#construction_common">Common options</a></li>
          <li><a href="#prefetch">Prefetch lists (non-AJAX)</a></li>
          <li><a href="#searchList">Search lists (AJAX)</a></li>
        </ul>
        <li><a href="#notifications">Notifications</a>
          <ul>
            <li><a href="#listSelection">List selections</a></li>
          </ul>
        </li>
        <li><a href="#selectionData">Getting the selection data</a></li>
        <li><a href="#directive">AngularJS Directive</a></li>
      </ul>
      <section id="main_content" class="inner">
        <h1>Documentation for autocomplete-lhc</h1>

        <p>The easiest way to get started is to check the <a
        href="index.html#demos">demos</a>.  Below each demo is a "show source" link that
        shows the code needed to construct an autocompleter with the options in the
        demo.  What follows here is detailed documentation for the various constructor
        options, list events (e.g. item selection) and the AngularJS directive.</p>

        <h2 id="construction">Constructing an Autocompleter</h2>

        <h3 id="construction_common">Options supported by both "search" (AJAX) and "prefetch"
        (non-AJAX) lists</h3>
        The constructors for both types of lists (Def.Autocompleter.Prefetch and
        Def.Autocompleter.Search) take an options argument as their third parameter.
        The following options are supported by both:

        <ul>
          <li>matchListValue - whether the field should validate its value
            against the list (default: false)</li>
          <li>maxSelect - (default 1) The maximum number of items that can be
           selected.  Use '*' for unlimited.</li>
          <li>twoColumnFlow - (default: true) Whether to allow long lists to
           flow into two columns to show more of the list on the page.</li>
          <li>suggestionMode - an integer specifying what type of suggestion
           should be offered based on what the user has typed.  The suggestion is placed
           as the top-most item in the list.  If this is not
           specified, the default is [Def.Autocompleter.]SUGGEST_SHORTEST, which
           means "pick the shortest match."  A value of
           NO_COMPLETION_SUGGESTIONS means no suggestions, and a value of
           USE_STATISTICS means that the suggestion is based on statistics, and
           that we will rely on the server to return the best item as the first
           item in the list.</li>
          <li>wordBoundaryChars - (default none) For autocompleting based on part of the
           field's value, this should be an array of the characters that are
           considered "word" boundaries (e.g. a space, but could be something
           else).  When this option is used, maxSelect is ignored.
          <li>headerBar - If the page has a fixed-position element at the top of
           the page (e.g. a top navigation bar), the autocompleter needs to know
           that so that when scrolling to show the list it doesn't scroll the
           current
           field under the header bar.  This is the element ID for such a header
           bar.</li>
          <li>scrolledContainer - the element that should be scrolled to bring
           the list into view if it would otherwise extend below the edge of the
           window. The default is document.documentElement (i.e. the whole
           window).  This may be null if no scrolling is desired (e.g. if the
           list field is in a fixed position on the window), but in that
           case the list element might be unusually short.
           Note:  At present the only tested cases of this parameter are the
           default value and null.</li>
        </ul>

        <h3 id="prefetch">Constructing a "prefetch" (non-AJAX) autocompleter</h3>
        A "prefetch" list gets its name from the having all of its list items
        "fetched" in advance, i.e. loaded with the page and not via AJAX,
        although it is possible to completely replace the list with another after the
        page loads (via the setListAndField method).  The syntax is as follows:

        <p><code>new Def.Autocompleter.Prefetch(field, [array, of, items],
        options);</code></p>

        <div>Parameters:
          <ol>
            <li>the ID or DOM Element of the form field for which the list is
                displayed.  If an element is provided, it must contain an ID
                attribute, or one will be assigned.</li>
            <li>the array of completion options (list values).  If not
               specified here, the list can be supplied later by a call to the
               setListAndField function.</li>
            <li>(optional) an options hash, which can include:
              <ul>
                <li>any of the <a href="#construction_common">common options</a>
                  described above</li>
                <li>addSeqNum - whether sequence numbers should be added to the items
                    in the prefetched answer list (default true).</li>
                <li>defaultValue - Either the code or the item text of the default value
                 for this list's field.  The default value is placed in the
                 field the first time the user focuses the field.</li>
                <li>codes - an array of code strings for the list values, for use in
                  contexts where answer lists have associated codes which are relied on rather
                  than the display strings for the users.  This should
                  be the same length as the list values array.</li>
                <li>autoFill - If true, the field will be filled in with
                  the list's value if setListAndField is called with a one-item
                  list.</li>
                <li>itemToHeading - a hash of item codes to codes of item headings,
                 where both items and headings appear in the listItems array.  This
                 parameter requires that the codes parameter also be supplied.</li>
              <ul>
            </li>
          </ol>
        </div>

        <h3 id="searchList">Constructing a "search" (AJAX) autocompleter</h3>
        A "search" list is an AJAX-based autocompleter, where AJAX requests
        return result lists which match the user's input in the field.  The
        syntax is as follows:

        <p><code>new Def.Autocompleter.Search(field, url, options);</code></p>

        <div>Parameters:
          <ol>
            <li>the ID or DOM Element of the form field for which the list is
              displayed.  If an element is provided, it must contain an ID
              attribute, or one will be assigned.</li>
            <li id="url">url for getting the completion list.  The website answering the
             URL is expected to understand the following parameters:
              <ul>
                <li>terms - the text from the field.  This should be used to find
                 matching list items.</li>
                <li>maxList - (optional) If present, this signifies that this is
                 a request for a large list of search results (e.g. by using the
                 "see more" link on the list).  If maxList is not present, that
                 means this is an autocompletion request and the server should
                 return a short list (e.g. 7 items) as quickly as possible.
                 In version 10, this replaced the autocomp parameter, which had
                 the opposite meaning and default.</li>
                <li>authenticity_token - (optional) This is an anti-CSRF parameter.
                 If the page has a value in window._token, it will get sent in this
                 parameter.</li>
                <li>suggest - (optional) User input that does not match a list value
                 will trigger a request for suggestions that are close to what the
                 user typed.  A "suggest" parameter value of "1" means the request
                 is for suggestions.</li>
                <li>field_val - When "suggest"==1, this will contain the value the user
                 typed in the field (instead of the "terms" parameter).</li>
              </ul>
              The URL's response should be an array.  For a non-suggestion request
              (suggest != '1'), it should have the following elements:
              <ul>
                <li>position 0 - the total search result count (including the ones not
                 returned, if autocomp==1).</li>
                <li>position 1 - the list of codes for the list items (if the items are
                 coded)</li>
                <li id="extraData">position 2 - A hash of extra data about the list items (e.g.
                 an extra set of codes), or null if there is none.
                 The keys in the hash should be names for the
                 data elements, and the values should be an array of values, one for
                 each returned item.  Configuration controlling what gets returned here is out
                 of scope for this class; the search autocompleter just sends the
                 parameters above to the given URL.  The extra data for the selected item (when the
                 user makes a selection) can get be retrieved with
                 <a href="#getItemData">getItemData(itemText)</a>.</li>
                <li>position 3 - the list item data; each item is an array of display
                 string fields which will be joined together.  (At a mimimum, each item
                 should be an array of one string.)</li>
                <li>position 4 - (optional) This is an array of code system names
                 identifying the code system for each of the codes in the code
                 array in position 1.  This is useful for lists that contain
                 entries from different code systems.  (Prior to version 15, this
                 field was a flag indicating the presence of span tags in the
                 display strings for highlighting matched regions.  Those are
                 still supported, but the flag is no longer needed.)</li>
              </ul>
              For a suggest request, the response should have the following elements:
              <ul>
                <li>position 0 - the list of codes for the suggested items (if the
                 items have codes)</li>
                <li>position 1 - the list of display strings (an array of strings, not
                 of arrays) for the suggested items.</li>
                <li>position 2 - A hash of extra data about the list items (the same
                 as position 2 for the non-suggestion request above.)</li>
              </ul>
            </li>
            <li>(optional) an options hash, which can include:
              <ul>
                <li>any of the <a href="#construction_common">common options</a>
                 described above</li>
                <li>minChars - (default 1, as of version 11) The minimum number
                 of characters that must be in the field before autocompletion
                 will start.</li>
                <li>matchListValue - Whether the field value is required to be one from
                 the list (default: false).  When this field is false, for a
                 non-matching value a dialog will be shown with a list of suggestions
                 that are on the list-- unless that is disabled by setting
                 nonMatchSuggestions to false.</li>
                <li>nonMatchSuggestions - (default: false, as of version 10)
                 Whether the user should be given a list of suggestions if they
                 enter a non-matching value.
                 This only applies when matchListValue is false.</li>
                <li>tableFormat - If true, then if the list's items contain
                 multiple fields, the list will be formatted in a table instead of just
                 concatenating the fields together for each list item.</li>
                <li>valueCols - Used when tableFormat is true to indicate
                 which columns in the table should be combined to form the field value
                 when the row is selected.  This should be an array of column indices
                 (starting with 0).  If absent, all columns will be combined for the
                 value.  Note that the specification here must result in unique field
                 values for each table row.</li>
                <li>colHeaders - Used when tableFormat is true, this is an array
                 of column headers for the columns in the table.  If this is not
                 supplied, no header row will be created.</li>
                <li>useResultCache - (default: true) Whether or not the results
                 should be cached.  As of 10.0.3, the cache is based on the URL,
                 so that autocompleting fields on the same page using the same
                 URL will use the same cache.  (In prior versions, the cache was
                 shared only for fields with the same name, or more
                 specifically, with the same return value for
                 Def.Autocompleter.getFieldLookupKey.)</li>
                <li>autocomp - a boolean that controls whether the field should
                 also autocomplete as the user types.  When this is false, the user
                 won't see an autocompletion list until they hit return.  (Default:  true)</li>
                <li>buttonID - (optional) the ID of a button to initiate a search based on
                 the field's value.  This is useful if you do not want the field
                 to autocomplete (i.e. autocomp==false) but you still want to show a list of search
                 results in response to a button.</li>
              </ul>
            </li>
          </ol>
        </div>

        <h2 id="notifications">Notifications</h2>
        <p>The autocompleter allows you to register callbacks for certain
         events.  The source file <a
         href="https://github.com/lhncbc/autocomplete-lhc/blob/master/source/autoCompEvents.js"
         >autoCompEvents.js</a> provides the full list; here we'll just document
         the list selection event, which is the most likely to be useful.</a>

        <h3 id="listSelection">List Selection Events</h3>
        <p>Sometimes you might need to get notified when the user has picked a
         value from a list, or has entered a non-list value.  In that case you can
         register a callback like this:
        <p><code>Def.Autocompleter.Event.observeListSelections(fieldKey, callback);</code></p>

        <p>The parameters are as follows:
          <ul>
            <li>fieldKey - This is usually the name (or ID) of the field, unless
              you have overridden Def.Observer.lookupKey (which you might do if you wanted the
              same callback to apply to multiple fields).  Fields whose lookupKey() value matches
              fieldKey will trigger the callback for this event.
              This parameter can be null, in which case the function will be called for every
              event of this kind, regardless of the field for which it
              occurred.</li>
            <li>callback - the function to be called when the event occurs.
              The function will be called with a hash argument with the following keys:
              <ul>
                <li>val_typed_in (what the user actually typed in)</li>
                <li>final_val (the final value for the field)</li>
                <li>used_list (boolean indicating whether or not the final was
                 selected from a list, whether by clicking or by arrows)</li>
                <li>on_list - boolean indicating whether or not the final value was on
                 the list</li>
                <li>input_method ('clicked', 'arrows', or 'typed')</li>
                <li>item_code - the code for the selected item, or null if there isn't
                 a code</li>
                <li>removed - For multi-select lists, this indicates whether the
                 selection was actual an unselection, removing the named item from the
                 list of selected items.  When true, final_val is the removed value
                 (although for multi-select fields the field is blank afterward).
                 (Optional; default false)</li>
                <li>list - the items that were in the list (which is the full list for a
                 prefetched list, or the portion shown to the user for a search
                 list).</li>
                <li>field_id - the ID of the list field</li>
              </ul>
            </li>
          </ul>
        </p>

        <h2 id="selectionData">Getting the selection data</h2>
        <p>For simple use cases, getting what the user picked is as simple as
          looking in the field.  For more complicated ones, APIs are provided
          for getting the code for the selected item, for getting selected items for
          multi-select lists (for which the field itself will be blank), and for getting
          the extra item data returned for a search list's AJAX call.  These
          APIs are defined on the autocompleter instance, and if you don't have a reference to
          that, you can access it from the field's DOM element as element.autocomp</p>

        <dl>
          <dt>getSelectedItems()</dt>
          <dd>Returns the display strings for the currently selected items or an
            empty array if there are none.</dd>
          <dt>getSelectedCodes()</dt>
          <dd>Returns the codes for the currently selected items or an empty
            array if there are none.
            If some of the selected items do not have a code, there will be null in
            that place in the returned array.</dd>
          <dt>getSelectedItemData()</dt>
          <dd>Returns all information about the currently selected list items,
            as an array of hashes, each with at least a "text" property for the
            item's display text.  The hashes may also contain (if the data was
            provided) properties "code", "code_system", and "data" (which for search
            lists contains the "extra data" fields for that item).  The return value
            will be null if there are no selected items.</dd>
          <dt>getItemCode(itemText)</dt>
          <dd>Returns the code for the given item text, or null if there isn't
           one.  For search lists, itemText must be present in the list
           retrieved for the last character typed.</dd>
          <dt id="getItemData">getItemData(itemText)</dt>
          <dd><b>(For search lists only.)</b>Returns a hash of all data about
           the given item, which must be among the items of the last list
           retrieved.  The returned hash will have "code" and "text" properties
           for the selected item, and if there is any <a href="#extraData">extra
           data</a> for the item, that will be under a "data" sub-hash.  If the
           items came with code system data, there will also be a "code_system"
           property with the code system corresponding to "code".  Properties
           for which there are no values will not be present, except for the
           "text" property.  Note that this data is also collected and
            returned by the getSelectedItemData() call above, which might be
            easier to use.</dd>
        </dl>

        <h2 id="directive">AngularJS Directive</h2>
        <p>If you are using AngularJS, you can set up your autocompleters via
          directive.  For example:</p>

        <p><code>&lt;input id="myfield" autocomplete-lhc="opts" ng-model="selectedVal"&gt;</code></p>

        <p>The opts object contains the options normally passed into the
          constructor.  (Note:    As of version 8.0.0 of the autocompleter, this
          object is watched for changes, so if you return it via a function call, the
          function should return the same object unless the options really
          change.)
          As mentioned above, there are two types of autocompleters.  You can
          either have a "prefetch" list where all the items are given to the autocompleter
          at construction time, or a "search" list where the list items are discovered
          as the user types, via AJAX calls.  For both types, opts is a hash, but the
          keys on the hash differ.</p>

        <p>For "prefetched lists", opts can contain:</p>
        <ul>
          <li>listItems - (required) This is the list item data.  It should be an array,
            and each element in the array should have a "text" property which is the
            display string the user sees.  The object containing that text property
            is what will get stored on the model you have associated via ng-model
            (selectedVal, in the example above).  So, if you wish you can have
            other properties holding data about each item, and the whole object gets placed
            in the model when the user selects an item.</li>
          <li>maxSelect - (default: 1) the maximum number of items that can be selected
            from the list.  If this is '*', an unlimited number can be selected.  When
            more than one item can be selected, selected items are stored in an array
            on the model (e.g., selectedVal in the example above becomes an array).</li>
          <li>defaultValue - The default value for the field.  This setting also exists in
            the non-directive prefetch lists, but there are two differences here:
            <ul>
              <li>defaultValue can either be one of the list item display strings (the
               "text" property), or it can be a hash like {code: 'AF-5'}, where "code" is
               a key on the list item object, and 'AF-5' is the value of that key
               to select the item as the default.  This is to allow the default value
               to be specified not just by the display string, but by other attributes
               of the list item object.</li>
              <li>the default list item is loaded into the field when the autocompletion
               is set up.</li>
            </ul>
          </li>
          <li>Any other parameters used by the Def.Autocompleter.Prefetch <a
            href="#prefetch">constructor</a>.  (Look also at the <a
            href="#construction_common">options</a> common to both
            types of autocompleter.</li>
        </ul>

        <p>For "search" lists, opts can contain:</p>
        <ul>
          <li>url - (required) The URL to which requests for data should be sent.  For
            details about expected query parameters and response data, see the
            comments for the <a href="#url">url</a> parameter for the
            Def.Autocompleter.Search <a href="#searchList">constructor</a></li>
          <li>Any other parameters used by the Def.Autocompleter.Search
            <a href="#searchList">constructor</a>.  (Look also at the <a
            href="#construction_common">options</a> common to both
            types of autocompleter.</li>
        </ul>

      </section>
    </div>
        <div id="footer_wrap" class="outer">

      <footer class="inner">
        <p class="copyright">Autocomplete-lhc is maintained by <a
        href="http://lhncbc.nlm.nih.gov/">Lister Hill National Center for Biomedical
        Communications</A>, <a href="http://www.nlm.nih.gov">National Library of Medicine</a></p>
        <p>Published with <a href="https://pages.github.com">GitHub Pages</a></p>
      </footer>
    </div>



  </body>
</html>
