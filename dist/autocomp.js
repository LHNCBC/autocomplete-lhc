Element.addMethods({scrollTo:function(a,b,c){var a=$(a);if(1==arguments.length){var d=a.cumulativeOffset();window.scrollTo(d[0],d[1])}else a.scrollLeft=b,a.scrollTop=c;return a}}),Effect.Scroll=Class.create(),function(a,b){Object.extend(Object.extend(b.Scroll.prototype,b.Base.prototype),{currentScrollPos:function(){var a;return a=this.element===window?document.viewport.getScrollOffsets():this.element===document.documentElement&&0===document.documentElement.scrollTop&&0===document.documentElement.scrollLeft?{left:document.body.scrollLeft,top:document.body.scrollTop}:{left:this.element.scrollLeft,top:this.element.scrollTop}},initialize:function(c){if(this.element=a(c),!this.element)throw b._elementDoesNotExistError;var d=this.currentScrollPos(c),e=Object.extend({x:0,y:0},arguments[1]||{}),f={x:d.left+e.x,y:d.top+e.y};this.start(f)},setup:function(){},update:function(a){var b=this.currentScrollPos(this.element),c=Math.round((this.options.x-b.left)*a+b.left),d=Math.round((this.options.y-b.top)*a+b.top);this.element.scrollTo(c,d),this.element===document.documentElement&&document.body.scrollTo(c,d)}})}($,Effect),function(a,b,c){var d={HTMLEvents:/^(?:load|unload|abort|error|select|change|submit|reset|focus|blur|resize|scroll)$/,MouseEvents:/^(?:click|mouse(?:down|up|over|move|out))$/},e={pointerX:0,pointerY:0,button:0,ctrlKey:!1,altKey:!1,shiftKey:!1,metaKey:!1,bubbles:!0,cancelable:!0};b.simulate=function(b,c){var f,g=Object.extend(e,arguments[2]||{}),h=null;b=a(b);for(var i in d)if(d[i].test(c)){h=i;break}if(!h)throw new SyntaxError("Only HTMLEvents and MouseEvents interfaces are supported");return document.createEvent?(f=document.createEvent(h),"HTMLEvents"==h?f.initEvent(c,g.bubbles,g.cancelable):f.initMouseEvent(c,g.bubbles,g.cancelable,document.defaultView,g.button,g.pointerX,g.pointerY,g.pointerX,g.pointerY,g.ctrlKey,g.altKey,g.shiftKey,g.metaKey,g.button,b),b.dispatchEvent(f)):(g.clientX=g.pointerX,g.clientY=g.pointerY,f=Object.extend(document.createEventObject(),g),b.fireEvent("on"+c,f)),b},c.addMethods({simulate:b.simulate})}($,Event,Element),"undefined"==typeof Def&&(Def={}),function(a){a.Observable={callbacks_:null,notifyObservers:function(a,b,c){null!==this.callbacks_&&(c.field_id=a?a.id:null,setTimeout(function(){var d=this.callbacks_[b];if(void 0!==d){if(null!==a)var e=this.lookupKey(a),f=d[e];for(var g=d[null],h=[f,g],i=0,j=h.length;j>i;++i){var k=h[i];if(void 0!==k)for(var l=0,m=k.length;m>l;++l)k[l].call(this,c)}}}.bind(this),1))},lookupKey:function(a){return a.name},storeCallback:function(a,b,c){null===this.callbacks_&&(this.callbacks_={});var d=this.callbacks_[b];void 0===d&&(d={},this.callbacks_[b]=d);var e=d[a];void 0===e&&(e=[],d[a]=e),e.push(c)}}}(Def),function(a){a.ScreenReaderLog=function(a){if(void 0===a){for(var b="reader_log",a=b,c=1;document.getElementById(a);)a=b+ ++c;this.logElement_=document.createElement("div"),this.logElement_.writeAttribute("id",a),document.body.appendChild(this.logElement_)}else this.logElement_=document.getElementById(a);this.logElement_.writeAttribute("aria-live","assertive"),this.logElement_.writeAttribute("aria-relevant","additions"),this.logElement_.writeAttribute("role","log"),this.logElement_.writeAttribute("class","screen_reader_only")},a.ScreenReaderLog.prototype={add:function(a){var b=document.createElement("p");b.appendChild(document.createTextNode(a)),this.logElement_.appendChild(b)}},a.ScreenReaderLog.add=function(b){this.log_||(this.log_=new a.ScreenReaderLog("reader_log")),this.log_.add(b)}}(Def),"undefined"==typeof Def&&(Def={}),function(a,b,c){c.RecordDataRequester=Class.create();var d={formField_:null,codeField_:null,dataURL_:null,dataReqInput_:null,dataReqOutput_:null,inputFieldsHash_:null,outputFieldsHash_:null,noPriorDataReq_:!0,latestPendingAjaxRequest_:null,lastFieldVal_:null,lastDataHash_:null,outputToSameGroup_:null,autoCompUpdateList_:null,initialize:function(a,b,c,d,e){this.formField_=a,this.dataURL_=b,this.dataReqInput_=c,this.dataReqOutput_=d,this.outputToSameGroup_=e,this.setOutputNamesToRDRNames(a,d)},setOutputNamesToRDRNames:function(a,b){for(var d=c.Autocompleter.getFieldLookupKey(a),e=c.RecordDataRequester.outputFieldNameToRDRFieldName_,f=0,g=b.length;g>f;++f)e[b[f]]=d},dupForField:function(b){return new c.RecordDataRequester(a(b),this.dataURL_,this.dataReqInput_,this.dataReqOutput_,this.outputToSameGroup_)},requestData:function(a){this.noPriorDataReq_=!1,this.inputFieldsHash_||this.initFieldsHash(),this.dataRequestOptions_||(this.dataRequestOptions_={}),a||this.clearDataOutputFields(),this.dataRequestOptions_.onComplete=a?this.onDataReqCompleteForListData.bind(this):this.onDataReqComplete.bind(this),this.dataRequestOptions_.parameters=this.buildParameterString(),this.latestPendingAjaxRequest_=new Ajax.Request(this.dataURL_,this.dataRequestOptions_),this.lastFieldVal_=c.Autocompleter.getFieldVal(this.formField_)},assignListData:function(){this.noPriorDataReq_&&""!==c.Autocompleter.getFieldVal(this.formField_)&&this.requestData(!0)},getFieldData:function(a){var b=null;return this.lastDataHash_&&c.Autocompleter.getFieldVal(this.formField_)===this.lastFieldVal_&&(b=this.lastDataHash_[a]),b},onDataReqComplete:function(a){if(this.latestPendingAjaxRequest_===a.request){this.lastFieldVal_=c.Autocompleter.getFieldVal(this.formField_);var b=a.responseText.evalJSON();this.lastDataHash_=b,this.assignDataToFields(b),this.processUpdateList(b),this.latestPendingAjaxRequest_=null}},onDataReqCompleteForListData:function(a){if(this.latestPendingAjaxRequest_===a.request){var b=a.responseText.evalJSON();this.lastDataHash_=b,this.assignDataToFields(b,!0),this.processUpdateList(b),this.latestPendingAjaxRequest_=null}},clearDataOutputFields:function(){this.inputFieldsHash_||this.initFieldsHash();for(var a=[],b=this.getOutputFieldsHash(),d=0,e=this.dataReqOutput_.length;e>d;++d){var f=b[this.dataReqOutput_[d]];if(void 0!==f)for(var g=0,h=f.length;h>g;++g){var i=f[g];i.autocomp&&i.autocomp.setListAndField?i.autocomp.setListAndField([]):(c.Autocompleter.setFieldVal(i,"",!1),a.push(i))}}c.Autocompleter.Event.notifyObservers(null,"RDR_CLEARING",a)},addFieldsToUpdateList:function(a,b,c){null===this.autoCompUpdateList_&&(this.autoCompUpdateList_={}),null===this.autoCompUpdateList_[a]&&(this.autoCompUpdateList_[a]={}),null===this.autoCompUpdateList_[a][c]?this.autoCompUpdateList_[a][c]=[b]:this.autoCompUpdateList_[a][c].push(b)},processUpdateList:function(b){if(null!==this.autoCompUpdateList_)for(var d in b){var e=b[d],f=e instanceof Array&&e.length>0;if(null!==this.autoCompUpdateList_[d])for(var g in this.autoCompUpdateList_[d]){var h=g.split(","),i=a(h[0]),j=c.Autocompleter.getFieldVal(i);if("EQ"===h[1]&&j===h[2]||"NE"===h[1]&&j!==h[2])for(var k=this.autoCompUpdateList_[d][g],l=0,m=k.length;m>l;l++)k[l].element&&(f?e[0]instanceof Array?k[l].setListAndField(e[0],e[1]):k[l].setListAndField(e):null===e&&k[l].setListAndField([],[]))}}},initFieldsHash:function(){this.inputFieldsHash_={};var a=c.Autocompleter;if(this.dataReqInput_)for(var b=this.dataReqInput_,d=0,e=b.length;e>d;++d){var f=b[d],g=a.findRelatedFields(this.formField_,f);1===g.length&&(this.inputFieldsHash_[f]=g[0])}this.outputToSameGroup_&&(this.outputFieldsHash_=this.constructOutputFieldsHash())},getOutputFieldsHash:function(){return this.outputToSameGroup_?this.outputFieldsHash_:this.constructOutputFieldsHash()},constructOutputFieldsHash:function(){for(var a={},b=this.dataReqOutput_,d=c.Autocompleter,e=0,f=b.length;f>e;++e){var g=b[e],h=d.findRelatedFields(this.formField_,g);h.length>0&&(a[g]=h)}return a},assignDataToFields:function(a,b){this.inputFieldsHash_||this.initFieldsHash();var d=[],e={},f=this.getOutputFieldsHash(),g=c.Autocompleter;for(var h in a){var i=f[h];if(void 0!==i)for(var j=0,k=i.length;k>j;++j){var l=i[j],m=a[h];if(m instanceof Array){if(null!==l.autocomp){var n=g.getFieldLookupKey(l);if(this.setOutputNamesToRDRNames(this.formField_,[n]),m.length>0&&m[0]instanceof Array?(m[2]&&l.autocomp.initHeadings(m[2]),b?l.autocomp.setList(m[0],m[1]):l.autocomp.setListAndField(m[0],m[1])):b?l.autocomp.setList(m):l.autocomp.setListAndField(m),null!==this.autoCompUpdateList_&&null!==this.autoCompUpdateList_[n]){var o={};o[n]=m,this.processUpdateList(o)}}}else b||(void 0!==l.comboField?l.comboField.mimicField(m,this.formField_.id):(c.Autocompleter.setFieldVal(l,m,!1),d.push(l),e[l.id]=m))}}c.Autocompleter.Event.notifyObservers(null,"RDR_ASSIGNMENT",{updatedFields:d,updatedFieldIDToVal:e,listField:this.formField_})},buildParameterString:function(){this.inputFieldsHash_||this.initFieldsHash();var a=null,b=this.formField_.autocomp.getSelectedCodes()[0];if(a=null!==b&&void 0!==b?"code_val="+encodeURIComponent(b):"field_val="+encodeURIComponent(c.Autocompleter.getFieldVal(this.formField_)),this.dataReqInput_)for(var d=0,e=this.dataReqInput_.size();e>d;++d){var f=this.dataReqInput_[d],g=this.inputFieldsHash_[f];if(void 0===g||null===g)throw"Could not find field for "+f;a+="&"+f+"="+encodeURIComponent(c.Autocompleter.getFieldVal(g))}return a+="&authenticity_token="+encodeURIComponent(window._token)||""}};Object.extend(c.RecordDataRequester.prototype,d),d=null,Object.extend(c.RecordDataRequester,{outputFieldNameToRDRFieldName_:{},getOutputFieldRDR:function(b){var d=null,e=a(b),f=c.Autocompleter.getFieldLookupKey(e),g=this.outputFieldNameToRDRFieldName_[f],h=c.Autocompleter.findRelatedFields(e,g);if(1===h.length){var i=h[0],j=i.autocomp;j&&(d=j.recDataRequester_)}return d}})}($,jQuery,Def),"undefined"==typeof Def&&(Def={}),function(a,b,c){c.FieldAlarms={setOffAlarm:function(a){void 0===this.bonk&&(this.bonk=new Audio(this.soundData_)),this.bonk.readyState>=2&&(this.bonk.currentTime=0,0!==this.bonk.currentTime&&(this.bonk.src=this.bonk.src)),this.bonk.play(),Effect.Shake(a.id,5)},cancelAlarm:function(a){a.shakeCanceled=!0,this.bonk.pause(),this.bonk.currentTime=0}}}($,jQuery,Def),Def.FieldAlarms.soundData_="data:audio/mp3;base64,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qqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqr/44LE/wAAA0gAAAAAqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqTEFNRTMuOTKqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqq","undefined"==typeof Def&&(Def={}),function(a,b,c){c.NoticeDialog=Class.create({});var d={dialog_:null,initialize:function(a){a||(a={}),a.autoOpen=!1,a.modal=!0,a.close=function(){},this.dialog_=b("<div></div>").dialog(a)},show:function(){if(!this.opening_){this.opening_=!0;var a=this.dialog_[0].parentNode.parentNode;this.backgroundListener_=function(){this.dialog_.dialog("close")}.bindAsEventListener(this),b(a).delegate(".ui-widget-overlay","click",this.backgroundListener_),this.dialog_.bind("dialogclose",function(){b(a).undelegate(".ui-widget-overlay","click",this.backgroundListener_)}.bindAsEventListener(this)),this.dialog_.dialog("open"),setTimeout(function(){this.dialog_[0].up().down(".ui-dialog-titlebar-close").focus()}.bind(this),1),this.opening_=!1}},hide:function(){var a=this.dialog_[0].parentNode.parentNode;b(a).undelegate(".ui-widget-overlay","click",this.backgroundListener_),this.dialog_.dialog("close")},isOpen:function(){return this.dialog_.dialog("isOpen")},setContent:function(a){this.dialog_.html(a),c.IDCache&&c.IDCache.addToCache(this.dialog_[0])},setTitle:function(a){this.dialog_.dialog("option","title",a)}};c.NoticeDialog.addMethods(d),c.ModalPopupDialog=Class.create({}),Object.extend(c.ModalPopupDialog.prototype,c.NoticeDialog.prototype);var e={show:function(){this.opening_||(this.opening_=!0,this.dialog_.dialog("open"),this.opening_=!1)},hide:function(){this.dialog_.dialog("close")}};c.ModalPopupDialog.addMethods(e)}($,jQuery,Def),"undefined"==typeof Def&&(Def={}),function(a,b,c){c.Autocompleter={currentAutoCompField_:-1,USE_STATISTICS:2,NO_COMPLETION_SUGGESTIONS:0,SUGGEST_SHORTEST:1,screenReaderLog_:new c.ScreenReaderLog,setOptions:function(a){Object.extend(this,a)},getFieldVal:function(a){return a.value},setFieldVal:function(a,b,c){var d=this.getFieldVal(a);a.value=b,d!==b&&c&&Element.simulate(a,"change")},getFieldLookupKey:function(a){return a.name},lookupFields:function(a){for(var b=[],c=0,d=document.forms.length;d>c;++c){var e=document.forms[c].elements[a];void 0!==e&&b.push(e)}return b},findRelatedFields:function(a,b){return this.lookupFields(b)},getFieldLabel:function(){return null},setOffAlarm:function(a){c.FieldAlarms.setOffAlarm(a)},cancelAlarm:function(a){c.FieldAlarms.cancelAlarm(a)},screenReaderLog:function(a){c.Autocompleter.screenReaderLog_.add(a)}},c.Autocompleter.Base=function(){},Object.extend(c.Autocompleter.Base,{MAX_ITEMS_BELOW_FIELD:7,classInit_:!1,classInit:function(){this.classInit_||(Element.insert(a(document.body),'<div id="searchResults" class="form_auto_complete">            <div id="completionOptionsScroller">           <span class="auto_complete" id="completionOptions"></span>            </div>            <div id="moreResults">See more items (Ctl Ret)</div>            <div id="searchCount">Search Results<!-- place holder for result count,             needed for height calculation--></div>            <div id="searchHint">Search Hint<!--place holder--></div>            </div>'),Event.observe("moreResults","mousedown",function(b){var d=a(c.Autocompleter.currentAutoCompField_);d.autocomp.handleSeeMoreItems(b),c.Autocompleter.Event.notifyObservers(d,"LIST_EXP",{list_expansion_method:"clicked"})}),Event.observe("completionOptionsScroller","mousedown",function(b){if("completionOptionsScroller"===b.target.id&&(Event.stop(b),b.stopImmediatePropagation(),c.Autocompleter.completionOptionsScrollerClicked_=!0,-1!=a(c.Autocompleter.currentAutoCompField_))){var d=a(c.Autocompleter.currentAutoCompField_);setTimeout(function(){d.focus()},1)}}.bind(this)),this.classInit_=!0)},noCaseSort:function(a,b){var c=a.toLowerCase(),d=b.toLowerCase();return c>d?1:d>c?-1:0},escapeAttribute:function(a){return a.replace(/&/g,"&amp;").replace(/"/g,"&quot;").replace(/'/g,"&#39;").replace(/</g,"&lt;").replace(/>/g,"&gt;")},unescapeAttribute:function(a){return a.replace(/&amp;/g,"&").replace(/&quot;/g,'"').replace(/&#39;/g,"'").replace(/&lt;/g,"<").replace(/&gt;/g,">")}}),Object.extend(c.Autocompleter.Base.prototype,Autocompleter.Base.prototype);var d={constructorOpts_:null,scoreField_:null,scoreFieldInitialized_:!1,itemToDataIndex_:null,selectedCodes_:null,selectedItems_:null,matchListValue_:null,invalidStatus_:!1,matchStatus_:!0,focusInProgress_:!1,refocusInProgress_:!1,listBelowField_:!0,listContainer:null,recDataRequester_:null,enabled_:!0,preFieldFillVal_:null,fieldValIsListVal_:null,indexToHeadingLevel_:{},suggestionMode_:this.SUGGEST_SHORTEST,lastScrollEffect_:null,multiSelect_:!1,listExtraData_:null,defAutocompleterBaseInit:function(d){d||(d={}),void 0!==d.suggestionMode&&(this.suggestionMode_=d.suggestionMode),void 0===d.maxSelect&&(d.maxSelect=1),"*"===d.maxSelect&&(d.maxSelect=1/0),this.multiSelect_=1!==d.maxSelect,this.constructorOpts_=d,this.selectedCodes_={},this.selectedItems_={};{var e=d.dataRequester;d.suggestionMode}if(c.Autocompleter.Base.classInit_||c.Autocompleter.Base.classInit(),this.matchListValue_=d.matchListValue||!1,this.recDataRequester_=e,d.maxSelect>1){var f=b('<span class="autocomp_selected"><ul></ul></span>')[0],g=this.element.parentNode;g.replaceChild(f,this.element),f.appendChild(this.element),this.selectedList=f.down()}this.element.writeAttribute("role","combobox"),this.element.writeAttribute("aria-expanded","false"),this.onHoverListener=this.onHover.bindAsEventListener(this),this.onMouseDownListener=this.onMouseDown.bindAsEventListener(this),Event.observe(this.element,"change",this.onChange.bindAsEventListener(this)),Event.observe(this.element,"keypress",this.changeToFieldByKeys.bindAsEventListener(this));var h=function(){this.typedSinceLastFocus_=!0}.bind(this);Event.observe(this.element,"paste",h),Event.observe(this.element,"cut",h),this.listContainer=a("searchResults"),this.options.showList=this.showList.bind(this),this.options.hideList=this.hideList.bind(this),this.options.posAnsList=this.posAnsList.bind(this),this.update.style.display="block",this.element.autocomp=this},dupDataReqForField:function(a){var b=null;return this.recDataRequester_&&(b=this.recDataRequester_.dupForField(a)),b},getSelectedCodes:function(){return Object.keys(this.selectedCodes_)},getSelectedItems:function(){return Object.keys(this.selectedItems_)},storeSelectedItem:function(){var a=this.element.value,b=this.getItemCode(a);1===this.constructorOpts_.maxSelect&&(this.selectedCodes_={}),null!==b&&(this.selectedCodes_[b]=1),this.selectedItems_[a]=1},getItemCode:function(a){this.itemToDataIndex_||this.initItemToDataIndex();var b=this.itemToDataIndex_[a],c=null;return void 0!==b&&this.itemCodes_&&(c=this.itemCodes_[b]),c},moveEntryToSelectedArea:function(){var a=c.Autocompleter.Base.escapeAttribute(this.element.value),d=b('<li><button type="button" alt="'+a+'"><span aria-hidden="true">&times;</span></button>'+a+"</li>")[0];this.selectedList.appendChild(d);var e=d.childNodes[0];b(e).click(b.proxy(this.removeSelection,this)),this.element.value="",this.uneditedValue="",c.Autocompleter.screenReaderLog("Selected "+a),this.onFocus()},removeSelection:function(a){var b=a.target.parentNode;"SPAN"===a.target.tagName&&(b=b.parentNode),b.parentNode.removeChild(b);var d=b.childNodes[1].textContent,e=this.getItemCode(d);delete this.selectedCodes_[e],delete this.selectedItems_[d],this.listSelectionNotification(d,!0,!0),c.Autocompleter.screenReaderLog("Unselected "+d)},isSelected:function(a){return this.selectedItems_&&void 0!==this.selectedItems_[a]},getScoreField:function(){return this.scoreFieldInitialized_||(this.scoreField_=c.Autocompleter.getScoreField(this.element),this.scoreField_&&(this.scoreFieldInitialized_=!0)),this.scoreField_},changeToFieldByKeys:function(a){if(!this.typedSinceLastFocus_){var b=!1;"undefined"==typeof a.which?b=!0:"number"==typeof a.which&&a.which>0&&(b=!a.ctrlKey&&!a.metaKey&&!a.altKey&&8!==a.which),this.typedSinceLastFocus_=b}},addObservers:function(a){Event.observe(a,"mousedown",this.onMouseDownListener)},listItemValue:function(a){return a.textContent},markPrevious:function(){null===this.preFieldFillVal_&&(this.preFieldFillVal_=this.element.value);var a=this.index;do this.index>0?this.index--:this.index=this.entryCount-1;while(this.indexToHeadingLevel_[this.index]&&this.index!==a);var b=this.getEntry(this.index);this.scrollToShow(b,this.update.parentNode),this.element.value=this.listItemValue(b),this.element.select()},markNext:function(){null===this.preFieldFillVal_&&(this.preFieldFillVal_=this.element.value);var a=this.index;do this.index<this.entryCount-1?this.index++:this.index=0;while(this.indexToHeadingLevel_[this.index]&&this.index!==a);var b=this.getEntry(this.index);this.scrollToShow(b,this.update.parentNode),this.element.value=this.listItemValue(b),this.element.select()},hideList:function(){if(c.Autocompleter.currentAutoCompField_===this.element.id){var a="visible"!==this.listContainer.style.visibility;a||(this.listContainer.style.visibility="hidden",this.listContainer.writeAttribute("aria-hidden","true"),this.element.writeAttribute("aria-expanded","false"))}},showList:function(){var a="visible"!==this.listContainer.style.visibility;this.listContainer.style.visibility="visible",this.listContainer.writeAttribute("aria-hidden","false"),this.element.writeAttribute("aria-expanded","true"),a&&!this.temporaryHide_&&this.entryCount>0&&c.Autocompleter.screenReaderLog("A list has appeared below the "+this.getFieldName()+".")},getFieldName:function(){if(void 0===this.fieldName_){var a=c.Autocompleter.getFieldLabel(this.element.id);this.fieldName_=null===a?"field":'field "'+a+'"'}return this.fieldName_},scrollToShow:function(a,b){if(a.offsetTop<b.scrollTop)b.scrollTop=a.offsetTop;else{var c=a.getHeight(),d=b.clientHeight;a.offsetTop+c-b.scrollTop>d&&(b.scrollTop=a.offsetTop+c-d)}},pageOptionsUpOrDown:function(b){var c,d=a("completionOptions"),e=d.clientHeight,f=d.firstChild.getHeight();if(b)d.scrollTop>0&&(c=d.scrollTop-e,0>c&&(c=0),d.scrollTop=c);else{var g=f-e;0>g&&(g=0),d.scrollTop<g&&(c=d.scrollTop+e,c>g&&(c=g),d.scrollTop=c)}},isSearchKey:function(a){return a.keyCode===Event.KEY_RETURN&&a.ctrlKey},onKeyPress:function(a){if(this.enabled_){var b="undefined"!=typeof this.fieldEventIsSearch,d=a.keyCode;b&&this.fieldEventIsSearch(a)?this.autocompKeyPress(a):this.active&&d===Event.KEY_TAB?(this.index>=0&&this.selectEntry(),this.observer&&clearTimeout(this.observer),this.preFieldFillVal_=null):this.active&&this.index>=0&&!a.shiftKey&&d===Event.KEY_RETURN?(this.autocompKeyPress(a),this.preFieldFillVal_=null):d!==Event.KEY_PAGEUP&&d!==Event.KEY_PAGEDOWN||!this.active?!a.ctrlKey&&(d===Event.KEY_LEFT||d===Event.KEY_RIGHT)&&this.active&&this.index>=0&&this.update.hasClassName("multi_col")?this.moveToOtherColumn(a):(d===Event.KEY_ESC&&null!==this.preFieldFillVal_?(this.element.value=this.preFieldFillVal_,c.Autocompleter.Event.notifyObservers(this.element,"CANCEL",{restored_value:this.preFieldFillVal_})):d!==Event.KEY_DOWN&&d!==Event.KEY_UP&&17!==d&&(this.preFieldFillVal_=null),16!==d&&17!==d&&this.autocompKeyPress(a)):this.pageOptionsUpOrDown(d===Event.KEY_PAGEUP)}},autocompKeyPress:function(a){Autocompleter.Base.prototype.onKeyPress.apply(this,[a])},setMatchStatusIndicator:function(a){a?this.element.hasClassName("no_match")&&(this.element.removeClassName("no_match"),c.Autocompleter.screenReaderLog("The field no longer contains a non-matching value.")):(this.element.addClassName("no_match"),c.Autocompleter.screenReaderLog("The field's value does not match any items in the list.")),this.matchStatus_=a},setInvalidValIndicator:function(a){a?(c.Autocompleter.setOffAlarm(this.element),this.invalidStatus_||(this.element.addClassName("invalid"),this.element.setAttribute("invalid",!0))):this.invalidStatus_&&(this.element.removeClassName("invalid"),this.element.setAttribute("invalid",!1)),this.invalidStatus_=a},cancelInvalidValIndicator:function(){c.Autocompleter.cancelAlarm(this.element)},updateChoices:function(a){if(this.index=-1,!this.changed&&this.hasFocus){if(this.update.innerHTML=a,Element.cleanWhitespace(this.update),Element.cleanWhitespace(this.update.down()),this.update.firstChild&&this.update.down().childNodes){if(this.entryCount=this.update.down().childNodes.length,this.suggestionMode_!==c.Autocompleter.NO_COMPLETION_SUGGESTIONS){var b;if(this.entryCount>0&&!this.focusInProgress_)if(this.add_seqnum&&this.element.value.match(/^\d+$/))for(this.index=0;this.indexToHeadingLevel_[this.index]&&this.index<this.entryCount;++this.index);else if(this.entryCount>1&&!this.numHeadings_){var d=this.suggestionMode_===c.Autocompleter.USE_STATISTICS,e=d?0:this.pickDefaultItem();if(e>-1){var f=this.update.firstChild,g=f.childNodes,h=g[e];h.addClassName("suggestion"),e>0&&f.insertBefore(h,g[0])}}}for(b=0;b<this.entryCount;b++){var i=this.getEntry(b);i.autocompleteIndex=b,this.addObservers(i)}}else this.entryCount=0;this.stopIndicator(),1===this.entryCount&&this.options.autoSelect?(this.selectEntry(),this.hide()):this.render(),this.focusInProgress_||this.setMatchStatusIndicator(this.entryCount>0||""===c.Autocompleter.getFieldVal(this.element))}},pickDefaultItem:function(){var a=this.element.value.trim().toLowerCase(),b=-1;if(a.length>0&&this.entryCount>0){for(var c=-1,d=1/0,e=-1,f=d,g=-1,h=d,i=this.update.firstChild.childNodes,j=0;j<this.entryCount;++j){var k=this.indexToHeadingLevel_[j];if(!k){var l=i[j],m=this.listItemValue(l).toLowerCase();m=m.replace(/^\W+/,"");var n=m.indexOf(a),o=this.update.firstChild.childNodes[j].innerHTML.length;0===n?/(^\d+$)/.test(a)?(e=0,f=0):f>o&&(e=j,f=o):-1===e&&(n>0?h>o&&(g=j,h=o):-1===g&&d>o&&(d=o,c=j))}}b=e>-1?e:g>-1?g:c}return b},posAnsList:function(){this.posListBelowFieldInMultiCol(),this.index>0&&this.scrollToShow(this.getCurrentEntry(),a("completionOptionsScroller"))},posListBelowFieldInMultiCol:function(){var c=this.element,d=this.update;d.style.height="";var e=this.listContainer,f=b(c).offset();e.style.left=f.left+"px",e.style.top=f.top+c.offsetHeight+"px",d.style.width="auto",this.listContainer.style.width="",a("completionOptionsScroller").style.height="";var g=document.documentElement,h=g.clientHeight;this.update.removeClassName("multi_col");var i=e.viewportOffset(),j=(i[1],h),k=e.getBoundingClientRect().bottom;if(k>j){var l=this.entryCount>4;if(l){var m=this.getEntry(0),n=2*m.offsetWidth+4,o=g.clientWidth;n>o-i[0]?l=!1:(this.listContainer.style.width=n+"px",this.update.addClassName("multi_col"),k=e.getBoundingClientRect().bottom)}if(!l||k>j){this.lastScrollEffect_&&this.lastScrollEffect_.cancel();var p=k-j,q=c.viewportOffset()[1],r=a("fe_form_header_0_expcol"),s=r?r.offsetHeight:0,t=q-s;p>t&&(p=t,this.setListHeight(h-c.offsetHeight-s-this.listContainer.offsetHeight+this.update.offsetHeight-15),k=e.getBoundingClientRect().bottom),this.lastScrollEffect_=new Effect.Scroll(g,{y:p,duration:.4});var u=a("spacer");u||(u=document.createElement("div"),u.setAttribute("id","spacer"),document.body.appendChild(u));var v=u.viewportOffset(),w=v[1]+u.offsetHeight;k>w&&(u.style.height=k-v[1]+"px")}}},setListHeight:function(b){this.listContainer.style.width=this.listContainer.offsetWidth+20+"px",a("completionOptionsScroller").style.height=b+"px"},getToken:function(){return this.element.value},getTokenBounds:function(){return[0,this.element.value.length]},dupForField:function(){throw"dupForField must be overridden by autocompleter subclasses."},initItemToDataIndex:function(){throw"initItemToDataIndex must be overridden by autocompleter classes that need it"},propagateFieldChanges:function(){this.recDataRequester_&&(this.matchStatus_&&""!==this.element.value.trim()?this.recDataRequester_.requestData():this.recDataRequester_.clearDataOutputFields())},listSelectionNotification:function(a,b,d){var e;void 0===d?d=!1:d&&(e=a,a=""),void 0===e&&(e=this.element.value);var f=this.clickSelectionInProgress_?"clicked":null===this.preFieldFillVal_?"typed":"arrows",g="typed"!==f&&b,h=this.getItemCode(e);c.Autocompleter.Event.notifyObservers(this.element,"LIST_SEL",{input_method:f,val_typed_in:a,final_val:e,used_list:g,list:this.rawList_,on_list:b,item_code:h,removed:d})},attemptSelection:function(){var a=!1,b=null===this.preFieldFillVal_?this.element.value:this.preFieldFillVal_;if(this.active){if(-1===this.index)for(var d=this.element.value.trim().toLowerCase(),e=0;e<this.entryCount&&!a;++e)d===this.listItemValue(this.getEntry(e)).toLowerCase()&&(a=!0,this.index=e);else a=this.entryCount>0;this.fieldValIsListVal_=a,a&&(Autocompleter.Base.prototype.selectEntry.apply(this),this.storeSelectedItem(),null!==c.Autocompleter.Event.callbacks_&&this.listSelectionNotification(b,!0),this.uneditedValue=this.element.value,this.setMatchStatusIndicator(!0),this.setInvalidValIndicator(!1),this.propagateFieldChanges(),1!==this.constructorOpts_.maxSelect&&this.moveEntryToSelectedArea()),this.multiSelect_||(this.active=!1,this.hide())}return a||this.matchListValue_||null===c.Autocompleter.Event.callbacks_||this.listSelectionNotification(b,!1),a},selectEntry:function(){this.attemptSelection()},handleNonListEntry:function(){this.matchStatus_=!1,this.propagateFieldChanges(),""===c.Autocompleter.getFieldVal(this.element)?(this.setMatchStatusIndicator(!0),this.setInvalidValIndicator(!1),null!==c.Autocompleter.Event.callbacks_&&this.listSelectionNotification("",!1)):(this.enabled_&&this.setMatchStatusIndicator(!1),this.matchListValue_?(c.Autocompleter.screenReaderLog("For this field your entry must match an item from the suggestion list."),this.setInvalidValIndicator(!0),this.refocusInProgress_=!0,setTimeout(function(){this.element.focus(),this.element.select()}.bind(this),1)):this.findSuggestions&&setTimeout(function(){this.findSuggestions()}.bind(this),1))},onChange:function(){if(!c.Autocompleter.completionOptionsScrollerClicked_){
var a=c.Autocompleter.getFieldVal(this.element);this.uneditedValue===a||""!==a&&this.attemptSelection()||(""===a&&(this.fieldValIsListVal_=!1),this.handleNonListEntry()),this.valueOnChange_=c.Autocompleter.getFieldVal(this.element),this.refocusInProgress_||(this.uneditedValue=this.valueOnChange_)}},onBlur:function(){if(c.Autocompleter.completionOptionsScrollerClicked_===!0)c.Autocompleter.completionOptionsScrollerClicked_=!1;else{var a=c.Autocompleter.getFieldVal(this.element);a!==this.valueOnChange_&&Element.simulate(this.element,"change"),this.enabled_&&!this.refocusInProgress_&&(this.hide(),this.hasFocus=!1,this.active=!1,this.invalidStatus_?(c.Autocompleter.setFieldVal(this.element,""),this.setInvalidValIndicator(!1),this.setMatchStatusIndicator(!0),""!=this.uneditedValue&&this.listSelectionNotification("",!1)):""===c.Autocompleter.getFieldVal(this.element)?this.setMatchStatusIndicator(!0):this.fieldValIsListVal_===!1&&this.setMatchStatusIndicator(!1))}},onFocus:function(){if(c.Autocompleter.currentAutoCompField_=this.element.id,this.valueOnChange_=c.Autocompleter.getFieldVal(this.element),this.refocusInProgress_||(this.uneditedValue=this.valueOnChange_),this.refocusInProgress_=!1,this.preFieldFillVal_=null,c.Autocompleter.Event.notifyObservers(this.element,"FOCUS",{start_val:this.uneditedValue}),this.multiSelect_){var a=Object.getOwnPropertyNames(this.selectedItems_),b=a.length;if(b>0){var d="Above this multi-select field are deselection buttons for each selected item.  Currently selected:"+a.join(", ");c.Autocompleter.screenReaderLog(d)}}},onMouseDown:function(a){var b=Event.findElement(a,"LI"),c=!this.indexToHeadingLevel_[b.autocompleteIndex];c&&(this.clickSelectionInProgress_=!0,Autocompleter.Base.prototype.onClick.apply(this,[a]),this.clickSelectionInProgress_=!1,Event.stop(a),this.element.focus(),this.multiSelect_&&this.showList())},onShow:function(a){a.autocomp.showList()},onHide:function(a){a.autocomp.hideList()},moveToOtherColumn:function(a){var b=this.update.firstChild.childNodes.length,c=Math.floor(b/2),d=Math.ceil(b/2),e=this.index;if(this.index<c?e=this.index+d:this.index>=d&&(e=this.index-d),e!==this.index&&!this.indexToHeadingLevel_[e]){this.index=e;var f=this.getEntry(this.index);this.element.value=this.listItemValue(f),this.element.select(),this.render(),Event.stop(a)}},handleSeeMoreItems:function(){},readSearchCount:function(){var b=!1;return"none"!==a("searchCount").style.display&&(c.Autocompleter.screenReaderLog("Showing "+a("searchCount").innerHTML+"."),"none"!==a("moreResults").style.display&&c.Autocompleter.screenReaderLog("Pressing control+return will expand the list."),b=!0),b},destroy:function(){this.stopObservingEvents(),this.detachFromDOM()},stopObservingEvents:function(){this.element.stopObserving()},detachFromDOM:function(){this.element.autocomp=null,this.element=null,this.update=null,this.listContainer=null,this.recDataRequester_=null}};Object.extend(c.Autocompleter.Base.prototype,d),d=null}($,jQuery,Def),function(a,b,c){c.Autocompleter.SuggestionDialog=Class.create({}),Object.extend(c.Autocompleter.SuggestionDialog.prototype,c.NoticeDialog.prototype);var d={getSuggestionDialog:function(){var a=this.suggestionDialog_;return a||(a=this.suggestionDialog_=new c.Autocompleter.SuggestionDialog({width:400}),a.resetDialog()),a}};Object.extend(c.Autocompleter.SuggestionDialog,d),d=null;var e={prepareSuggestionDialogForList:function(b){this.setTitle("Did you mean..."),this.setContent('The value "<em><span id="suggestionFieldVal"></span></em>" is not on our standard list of possible values.<div id="suggestionList" style="margin-top: 1em; margin-bottom: 1em"></div>'),a("suggestionFieldVal").innerHTML=b.value.escapeHTML()},resetDialog:function(){this.setTitle("Please Wait"),this.setContent('Please wait a second or two while we try to find "<span id="suggestionFieldVal"></span>"....')},showSuggestions:function(b,c){for(var d=["<ul>"],e=0,f=b.length;f>e;++e)d.push('<li><a href="" onclick="'),d.push("Def.Autocompleter.SuggestionDialog.getSuggestionDialog().hide();"),d.push("$('"),d.push(c.id),d.push("').autocomp.acceptSuggestion('"),d.push(e),d.push("'); return false\">"),d.push(b[e]),d.push("</a></li>");d.push("</ul>"),a("suggestionList").innerHTML="That is okay, but is one of the following values what you mean?"+d.join("")+"If none of these are right, "+this.returnToFieldLink(c)+" and backspace a few letters to be sure the choice you want was not in the choice menu, check the spelling carefully and re-enter if wrong, or accept what you have entered but realize it will not be understood by any of the PHR checking processes."},showNotFoundMsg:function(b){a("suggestionList").innerHTML="We were not able to find any standard values that came close to what you entered.  You might want to "+this.returnToFieldLink(b)+" and backspace a few letters to be sure the choice you want was not in the choice menu, or check the spelling carefully and re-enter if wrong.  You can let it remain as entered, but realize that it will not be understood by any of the PHR checking processes."},returnToFieldLink:function(a){return"<a href='javascript:void(0)' onclick='Def.Autocompleter.SuggestionDialog.getSuggestionDialog().hide(); var e = $(\""+a.id+"\"); e.focus(); e.selectionStart = e.selectionEnd; return false'>return to the field</a>"}};Object.extend(c.Autocompleter.SuggestionDialog.prototype,e),e=null}($,jQuery,Def),function(a,b,c){c.Autocompleter.Prefetch=Class.create(),c.Autocompleter.Prefetch.constructor=c.Autocompleter.Prefetch,Object.extend(c.Autocompleter.Prefetch.prototype,Autocompleter.Local.prototype),Object.extend(c.Autocompleter.Prefetch.prototype,c.Autocompleter.Base.prototype),c.Autocompleter.Prefetch.prototype.className="Def.Autocompleter.Prefetch";var d={SEQ_NUM_PREFIX:'<span class="listNum">',SEQ_NUM_SEPARATOR:":</span>&nbsp; ",validationFailed_:!1,listIsOriginal_:!0,rawList_:null,itemCodes_:null,listLoadAttempted_:!1,seeMoreItemsClicked_:!1,matchListItemsToField_:!1,defaultSelectionIndex_:null,autoFill_:!0,fullIndexToHeadingLevel_:{},initialize:function(a,b,d){d||(d={});var e=d.addSeqNum;this.add_seqnum=void 0===e?!0:e;var f=d.autoFill;void 0!==f&&(this.autoFill_=f);var g=d.updateDiv;c.Autocompleter.Base.classInit_||c.Autocompleter.Base.classInit(),g?Autocompleter.Local.prototype.initialize.apply(this,[a,g,[],{frequency:.01,partialChars:1}]):Autocompleter.Local.prototype.initialize.apply(this,[a,"completionOptions",[],{frequency:.01,partialChars:1,onShow:this.onShow,onHide:this.onHide,selector:this.selector}]),Event.observe(a,"focus",this.onFocus.bind(this)),this.onMouseMoveListener=this.onMouseMove.bindAsEventListener(this),this.defAutocompleterBaseInit(d),this.initHeadings(d);var h=d.codes;this.setList(b,h),this.listIsOriginal_=!0,this.originalCodes_=h,this.options.minChars=0,this.splitAutocomp_=!1,this.element.addClassName("ansList")},dupItemToDataIndex:function(a){this.listIsOriginal_&&(this.itemToDataIndex_||this.initItemToDataIndex(),a.itemToDataIndex_=this.itemToDataIndex_)},dupForField:function(a){var b=this.dupDataReqForField(a),d=Object.clone(this.constructorOpts_);d.dataRequester=b;var e=new c.Autocompleter.Prefetch(a,this.rawList_,d);return this.dupItemToDataIndex(e),e},initHeadings:function(a){var b=a.codes,c=a.itemToHeading;if(c){a.itemToHeading=null;for(var d={},e={},f=0,g=b.length;g>f;++f){var h=b[f],i=c[h];if(i){var j=d[i];if(!j){var k=c[i];j=k?d[k]+1:1,d[i]=j}}}for(f=0,g=b.length;g>f;++f)j=d[b[f]],e[f]=j?j:0;this.fullIndexToHeadingLevel_=e,a.indexToHeadingLevel=e,this.numHeadings_=$H(d).keys().length,a.numHeadings=this.numHeadings_}else a.indexToHeadingLevel&&(this.fullIndexToHeadingLevel_=a.indexToHeadingLevel,this.numHeadings_=a.numHeadings)},initItemToDataIndex:function(){if(this.itemToDataIndex_={},this.rawList_)for(var a=0,b=this.rawList_.length;b>a;++a)this.itemToDataIndex_[this.rawList_[a]]=a},selector:function(b){var d=b.getToken(),e=0,f=!b.matchListItemsToField_||""===b.element.value.trim(),g=b.seeMoreItemsClicked_?1/0:2*c.Autocompleter.Base.MAX_ITEMS_BELOW_FIELD,h=f&&!b.seeMoreItemsClicked_?Math.floor(g/b.numHeadings_):1/0;1>h&&(h=1);var i=0,j=["<ul>"],k=null,l=null,m=!1,n=0,o=0;b.indexToHeadingLevel_={},b.options.ignoreCase&&(d=d.toLowerCase());for(var p=0,q=b.rawList_.length;q>p;++p){var r=b.fullIndexToHeadingLevel_[p];if(r)k=b.rawList_[p],l=r,m=!1,++n;else{var s=null,t=b.rawList_[p];f&&(++e,s=t);var u=null,v=!1;if(b.add_seqnum&&(u=p+1-n+"",f||0!==u.indexOf(d)||(++e,g>e&&(u="<strong>"+u.substr(0,d.length)+"</strong>"+u.substr(d.length),v=!0,s=b.SEQ_NUM_PREFIX+u+b.SEQ_NUM_SEPARATOR+t))),!v&&!f){var w=!1,x=t;b.options.ignoreCase&&(x=t.toLowerCase());for(var y=x.indexOf(d);!w&&-1!==y;){if(g>e)if(0===y)++e,s="<strong>"+t.substr(0,d.length)+"</strong>"+t.substr(d.length),w=!0;else if(b.options.fullSearch||/(.\b|_)./.test(x.substr(y-1,2))){++e;var z=t.substr(0,y);s=z+"<strong>"+t.substr(y,d.length)+"</strong>"+t.substr(y+d.length),w=!0}w||(y=x.indexOf(d,y+1))}}b.multiSelect_&&b.isSelected(t)||!s||!(g>=e||b.numHeadings_>0&&f)||(k&&!m&&(m=!0,j.push('<li class="heading">'),j.push(k),j.push("</li>"),b.indexToHeadingLevel_[o++]=l,i=0),(!f||!b.numHeadings_||h>i)&&(!v&&b.add_seqnum&&(s=b.SEQ_NUM_PREFIX+u+b.SEQ_NUM_SEPARATOR+s),j.push("<li>"),j.push(s),b.indexToHeadingLevel_[o++]=0,j.push("</li>"),f&&++i))}}if(e>g?(a("searchCount").innerHTML=g+" of "+e+" items total",a("moreResults").style.display="block",a("searchCount").style.display="block"):(a("moreResults").style.display="none",a("searchCount").style.display="none"),f||e>0){j.push("</ul>");var A=j.join("")}else A="<ul></ul>";return A},setList:function(a,b){this.listIsOriginal_=!1;var c=a.length;this.rawList_=new Array(c);for(var d=0,e=a.length;e>d;++d)this.rawList_[d]=a[d].trim();for(var f=new Array(c),g=0;c>g;++g)f[g]=this.rawList_[g].escapeHTML(),this.add_seqnum!==!0||this.indexToHeadingLevel_[g]||(f[g]=this.SEQ_NUM_PREFIX+(g+1)+this.SEQ_NUM_SEPARATOR+f[g]);this.options.array=f,this.itemCodes_=b,this.itemToDataIndex_=null,this.enabled_=a.length>0,a.length>1?this.element.addClassName("ac_multiple"):this.element.removeClassName("ac_multiple"),(this.hasFocus||document.activeElement===this.element)&&this.onFocus()},setFieldToListValue:function(a){var b=this.element;b.value=a,this.storeSelectedItem(),this.uneditedValue=b.value,this.listSelectionNotification("",!0),this.setMatchStatusIndicator(!0),this.setInvalidValIndicator(!1),this.propagateFieldChanges(),Element.simulate(b,"change")},setListAndField:function(a,b,d,e){void 0===d&&(d=!1),void 0===e&&(e=!1),this.setList(a,b),c.Autocompleter.Event.notifyObservers(this.element,"LIST_ASSIGNMENT",{});var f,g=this.element.value,h=a.size();d===!1&&(f=this.autoFill_&&(1===h||h>1&&e)?this.assembleValue(a[0]):"",this.element.value=f,this.fieldValIsListVal_=!0),d||g===f||this.setFieldToListValue(f),this.setInvalidValIndicator(!1),this.setMatchStatusIndicator(!0),this.options.afterUpdateElement&&this.options.afterUpdateElement()},assembleValue:function(a){return a.trim()},onObserverEvent:function(){this.temporaryHide_=!0,this.hideList(),Autocompleter.Local.prototype.onObserverEvent.apply(this,[]),this.posAnsList(),this.showList(),this.temporaryHide_=!1},autocompKeyPress:function(a){if(this.active)switch(a.keyCode){case Event.KEY_RETURN:return void(a.ctrlKey?(this.handleSeeMoreItems(a),c.Autocompleter.Event.notifyObservers(this.element,"LIST_EXP",{list_expansion_method:"CtrlRet"}),a.stopImmediatePropagation()):this.index>=0&&(Event.stop(a),this.selectEntry(),this.multiSelect_||this.hide()));case 17:break;case Event.KEY_ESC:return this.index=-1,this.render(),this.hide(),this.active=!1,void Event.stop(a);default:this.matchListItemsToField_=!0,this.onKeyPressWrapper(a)}else this.matchListItemsToField_=!0,this.onKeyPressWrapper(a)},onKeyPressWrapper:function(a){a.ctrlKey||Autocompleter.Local.prototype.onKeyPress.apply(this,[a])},loadList:function(b,d){void 0===b&&(b=this.element.id);var e=c.Autocompleter.getFieldLookupKey(this.element);this.listLoadAttempted_=!0;var f=c.RecordDataRequester.getOutputFieldRDR(b);if(f){var g=f.getFieldData(e);if(g?this.setListAndField(g[0],g[1],!0,!1):f.assignListData(),b!==this.element.id){var h=a(d),i=[d,"EQ",c.Autocompleter.getFieldVal(h)];f.addFieldsToUpdateList(b,this,i)}}},listIsEmpty:function(){return 0===this.options.array.length},getInitialSelectionIndex:function(){var a=-1;if(""==this.element.value)if(this.defaultSelectionIndex_)a=this.defaultSelectionIndex_;else{var b=(c.Autocompleter.getFieldLookupKey(this.element),this.constructorOpts_.defaultValue);if(void 0!==b){if(this.itemCodes_)for(var d=0,e=this.itemCodes_.length;e>d;++d)this.itemCodes_[d]===b&&(a=d);if(-1===a)for(var f=0,g=this.rawList_.length;g>f;++f)this.rawList_[f]===b&&(a=f)}a>=2*c.Autocompleter.Base.MAX_ITEMS_BELOW_FIELD&&(a=-1),this.defaultSelectionIndex_=a}return a},onFocus:function(){if(c.Autocompleter.completionOptionsScrollerClicked_===!0)c.Autocompleter.completionOptionsScrollerClicked_=!1;else if(this.matchListItemsToField_=!1,this.listLoadAttempted_||!this.listIsEmpty()||this.element.comboField||this.loadList(),this.enabled_){this.listBelowField_=!0,this.focusInProgress_=!0,this.hideList(),c.Autocompleter.Base.prototype.onFocus.apply(this),this.element.shakeCanceled=!1,this.activate(),this.index=this.getInitialSelectionIndex(),this.index>=0&&(this.selectEntry(),this.element.select(),Element.simulate(this.element,"change")),this.render();var a=!1;if(0==this.add_seqnum)a=this.entryCount>0?!0:!1;else if(this.entryCount>1)a=!0;else if(1==this.entryCount){var b=this.listItemValue(this.update.firstChild.childNodes[0]);a=b==this.uneditedValue?!1:!0}else a=!1;1==a&&(this.posAnsList(),this.showList(),this.readSearchCount(),this.doNotCountHover||(this.doNotCountHover=!0,Event.observe(document,"mousemove",this.onMouseMoveListener))),this.focusInProgress_=!1}},onHover:function(a){this.doNotCountHover||Autocompleter.Local.prototype.onHover.apply(this,[a])},focusField:function(){this.element.focus()},onMouseMove:function(){this.doNotCountHover=!1,Event.stopObserving(document,"mousemove",this.onMouseMoveListener)},listItemValue:function(a){var b=a.innerHTML;if(this.add_seqnum){Prototype.Browser.IE&&(b=b.replace("SPAN","span"));var c=b.indexOf(this.SEQ_NUM_SEPARATOR);b=b.substring(c+this.SEQ_NUM_SEPARATOR.length)}return b.stripTags().unescapeHTML()},updateElement:function(a){return this.options.updateElement?void this.options.updateElement(a):(this.element.value=this.listItemValue(a),this.oldElementValue=this.element.value,void(this.options.afterUpdateElement&&this.options.afterUpdateElement(this.element,a)))},fieldEventIsSearch:function(a){return a.keyCode===Event.KEY_RETURN&&a.ctrlKey},handleSeeMoreItems:function(b){this.seeMoreItemsClicked_=!0,a("searchHint").style.display="none",this.listBelowField_=!1,this.getUpdatedChoices(),this.posAnsList(),this.seeMoreItemsClicked_=!1,this.splitAutocomp_=!1,Event.stop(b)},findItemIndexByCode:function(a){for(var b=null,c=0,d=this.itemCodes_.length;d>c&&!b;++c)a==this.itemCodes_[c]&&(b=c);return b},selectByCode:function(a){var b=this.findItemIndexByCode(a);null!=b&&this.setFieldToListValue(this.rawList_[b])},readSearchCount:function(){var a=c.Autocompleter.Base.prototype.readSearchCount.apply(this);return!a&&this.entryCount>0&&(c.Autocompleter.screenReaderLog("Showing "+this.entryCount+" of "+this.rawList_.length+" items."),a=!0),a}};Object.extend(c.Autocompleter.Prefetch.prototype,d),d=null}($,jQuery,Def),Ajax.Request.prototype.respondToReadyState_orig=Ajax.Request.prototype.respondToReadyState,Ajax.Request.prototype.respondToReadyState=function(a){try{this.respondToReadyState_orig(a)}catch(b){this.dispatchException(b)}},function(a,b,c){c.Autocompleter.Search=Class.create();var d={fieldToCache_:{},RESULT_CACHE_AUTOCOMP_RESULTS:1,RESULT_CACHE_SEARCH_RESULTS:0,MAX_VALUE_SIZE_FOR_AUTOCOMP:25,suggestionDialog_:null,constructor:c.Autocompleter.Search,superclass:c.Autocompleter.Base.prototype,LIST_ITEM_FIELD_SEP:" - "};Object.extend(c.Autocompleter.Search,d),d=null,Object.extend(c.Autocompleter.Search.prototype,Ajax.Autocompleter.prototype),Object.extend(c.Autocompleter.Search.prototype,c.Autocompleter.Base.prototype),c.Autocompleter.Search.prototype.className="Def.Autocompleter.Search";var e={lastAjaxRequest_:null,resultCache_:null,useResultCache_:!0,suggestionList_:null,initialize:function(b,d,e){e||(e={}),c.Autocompleter.Base.classInit_||c.Autocompleter.Base.classInit(),Ajax.Autocompleter.prototype.initialize.apply(this,[b,"completionOptions",d,{frequency:.01,minChars:2,partialChars:2,onHide:function(){a("searchCount").style.display="none",a("moreResults").style.display="none",c.Autocompleter.Base.prototype.hideList.apply(this)}.bind(this),onShow:function(){a("searchCount").style.display="block",a("moreResults").style.display="block",c.Autocompleter.Base.prototype.showList.apply(this)}.bind(this)}]),this.defAutocompleterBaseInit(e),this.autocomp=e.autocomp,this.autocomp||(this.options.frequency=31536e3),null!==e.useResultCache&&e.useResultCache===!1&&(this.useResultCache_=!1),Event.observe(b,"focus",this.onFocus.bind(this));var f=e.buttonID;this.buttonID=f,f&&"null"!==f&&(Event.observe(f,"mousedown",this.buttonClick.bind(this)),Event.observe(f,"keypress",this.buttonKeyPress.bind(this))),this.element.addClassName("search_field")},initItemToDataIndex:function(){this.itemToDataIndex_={}},dupForField:function(a){var b=this.dupDataReqForField(a),d=Object.clone(this.constructorOpts_);return d.dataRequester=b,new c.Autocompleter.Search(a,this.url,d)},runSearch:function(){this.lastAjaxRequest_&&this.lastAjaxRequest_.transport&&this.lastAjaxRequest_.transport.abort(),this.searchInProgress=!0,this.searchStartTime=(new Date).getTime();var a=this.element.value,b=null;if(this.useResultCache_&&(b=this.getCachedResults(a,c.Autocompleter.Search.RESULT_CACHE_SEARCH_RESULTS),b&&this.onComplete(b,!0)),!b){var d={parameters:{}};d.parameters.authenticity_token=window._token||"",d.parameters.terms=a,d.onComplete=this.options.onComplete,this.changed=!1,this.hasFocus=!0,this.lastAjaxRequest_=new Ajax.Request(this.url,d)}},getCachedResults:function(a,b){if(!this.resultCache_){var d=c.Autocompleter.getFieldLookupKey(this.element);this.resultCache_=c.Autocompleter.Search.fieldToCache_[d],this.resultCache_||(this.resultCache_=[{},{}],c.Autocompleter.Search.fieldToCache_[d]=this.resultCache_)}return this.resultCache_[b][a]},storeCachedResults:function(a,b,d){if(!this.resultCache_){var e=c.Autocompleter.getFieldLookupKey(this.element);this.resultCache_=c.Autocompleter.Search.fieldToCache_[e],this.resultCache_||(this.resultCache_=[{},{}],c.Autocompleter.Search.fieldToCache_[e]=this.resultCache_)}this.resultCache_[b][a]=d},fieldEventIsSearch:function(a){return a.keyCode===Event.KEY_RETURN&&(a.ctrlKey||!this.autocomp&&this.element.value!==this.uneditedValue&&""!==this.element.value.trim())},buttonKeyPress:function(a){a.keyCode===Event.KEY_RETURN&&this.runSearch()},processChoices:function(a,b,c){var d;return d=c?this.sortHighlightedResults(a):this.sortResults(a)},buildUpdateHTML:function(a){this.itemCodes_=a[1],this.listExtraData_=a[2];var b=a[3],c=a[4],d=this.processChoices(b,this.itemCodes_,c);this.rawList_=d;var e;return e=b.length>0?"<ul><li>"+d.join("</li><li>")+"</li></ul>":"<ul></ul>"},onComplete:function(b,d){if(this.lastAjaxRequest_===b.request&&(this.lastAjaxRequest_=null),200===b.status){var e=b.request.options,f=e.parameters.terms,g=e.parameters.autocomp,h=c.Autocompleter.Search;if(!d&&this.useResultCache_){var i=g?h.RESULT_CACHE_AUTOCOMP_RESULTS:h.RESULT_CACHE_SEARCH_RESULTS;this.storeCachedResults(f,i,b)}var j=g?this.element.value.substr(0,h.MAX_VALUE_SIZE_FOR_AUTOCOMP):this.element.value;if((this.hasFocus||this.refocusInProgress_)&&j===f){var k=JSON.parse(b.responseText),l=k[0];if(l>0){var m=k[3].length,n=m+" of "+l+" total";a("searchCount").innerHTML=n,a("searchCount").style.display="block"}this.updateChoices(this.buildUpdateHTML(k)),this.searchInProgress=!1;{a("completionOptions")}a("moreResults").style.display=this.entryCount<l&&e.parameters.autocomp?"block":"none";var o=new Date,p=o.getTime()-this.searchStartTime+1e3*this.options.frequency+"",q=b.responseText.length+"",r="; "+q+" bytes in "+p+" ms";p.length<3&&(r+="&nbsp;"),q.length<3&&(q+="&nbsp;"),a("searchCount").innerHTML+=r,this.listBelowField_=this.entryCount<=c.Autocompleter.Base.MAX_ITEMS_BELOW_FIELD,this.posAnsList()}}},getItemExtraData:function(){var a={};if(this.listExtraData_){for(var b=this.itemToDataIndex_[this.element.value],c=Object.keys(this.listExtraData_),d=0,e=c.length;e>d;++d)var f=c[d];a[f]=this.listExtraData_[f][b]}return a},sortResults:function(a){var b=a.length,d=new Array(b);this.itemToDataIndex_={};for(var e=c.Autocompleter.Search.LIST_ITEM_FIELD_SEP,f=0;b>f;++f){var g=a[f].join(e);d[f]=g.escapeHTML(),this.itemToDataIndex_[g]=f}var h=this.suggestionMode_===c.Autocompleter.USE_STATISTICS;if(h){var i=d[0];d[0]=""}return d=d.sort(c.Autocompleter.Base.noCaseSort),h&&(d[0]=i),d},sortHighlightedResults:function(a){var b=a.length,d=new Array(b);this.itemToDataIndex_={};for(var e=new Array(b),f={},g=c.Autocompleter.Search.LIST_ITEM_FIELD_SEP,h=0;b>h;++h){var i=a[h].join(g).escapeHTML();i=i.replace(/&lt;(\/)?span&gt;/g,"<$1span>");var j=i.replace(/<\/?span>/g,"");f[j]=i,e[h]=j,this.itemToDataIndex_[i]=h}var k=this.suggestionMode_===c.Autocompleter.USE_STATISTICS;if(k){var l=e[0];e[0]=""}for(e=e.sort(c.Autocompleter.Base.noCaseSort),k&&(e[0]=l),h=0;b>h;++h)d[h]=f[e[h]];return d},show:function(){("hidden"===this.listContainer.style.visibility||""===this.listContainer.style.visibility)&&this.options.onShow(this.element,this.update)},hide:function(){this.searchInProgress||c.Autocompleter.Search.superclass.hide.apply(this)},buttonClick:function(a){this.observer&&clearTimeout(this.observer),this.searchInProgress=!0,this.runSearch(),Event.stop(a)},handleSeeMoreItems:function(a){this.buttonClick(a)},onFocus:function(){c.Autocompleter.completionOptionsScrollerClicked_===!0?c.Autocompleter.completionOptionsScrollerClicked_=!1:(this.refocusInProgress_||(this.hide(),this.rawList_=[]),c.Autocompleter.Base.prototype.onFocus.apply(this),this.hasFocus=!0)},onBlur:function(a){this.refocusInProgress_||c.Autocompleter.completionOptionsScrollerClicked_||(c.Autocompleter.Base.prototype.onBlur.apply(this,[a]),this.searchInProgress||(this.active=!1))},autocompKeyPress:function(a){switch(this.CtrlReturn=!1,a.keyCode){case Event.KEY_RETURN:this.fieldEventIsSearch(a)?(Event.stop(a),a.stopImmediatePropagation(),this.CtrlReturn=!0,this.preFieldFillVal_&&(this.element.value=this.preFieldFillVal_),this.runSearch(),c.Autocompleter.Event.notifyObservers(this.element,"LIST_EXP",{list_expansion_method:"CtrlRet"})):this.active&&(Autocompleter.Base.prototype.onKeyPress.apply(this,[a]),this.uneditedValue=this.element.value);break;case 17:break;default:a.ctrlKey||Autocompleter.Base.prototype.onKeyPress.apply(this,[a])}},getUpdatedChoices:function(){this.lastAjaxRequest_&&this.lastAjaxRequest_.transport&&this.lastAjaxRequest_.transport.abort(),this.searchStartTime=(new Date).getTime();var a=null,b=c.Autocompleter.Search,d=this.element.value;if(d.length>b.MAX_VALUE_SIZE_FOR_AUTOCOMP&&(d=d.substr(0,b.MAX_VALUE_SIZE_FOR_AUTOCOMP)),this.useResultCache_&&(a=this.getCachedResults(d,b.RESULT_CACHE_AUTOCOMP_RESULTS),a&&this.onComplete(a,!0)),!a){var e={parameters:{}};e.parameters.authenticity_token=window._token||"",e.parameters.terms=d,e.parameters.autocomp=1,e.onComplete=this.options.onComplete,this.lastAjaxRequest_=new Ajax.Request(this.url,e)}},findSuggestions:function(){var b={parameters:{}};b.parameters.authenticity_token=window._token||"",b.parameters.field_val=this.element.value,b.parameters.suggest=1,b.onComplete=this.onFindSuggestionComplete.bind(this);var d=c.Autocompleter.SuggestionDialog.getSuggestionDialog();d.resetDialog(),d.show(),a("suggestionFieldVal").innerHTML=this.element.value.escapeHTML(),new Ajax.Request(this.url,b)},onFindSuggestionComplete:function(a){if(200===a.status){var b=JSON.parse(a.responseText),d=b[0],e=[],f=c.Autocompleter.SuggestionDialog.getSuggestionDialog();f.prepareSuggestionDialogForList(this.element);var g=!1;if(d.length>0){var h=b[1];this.suggestionList_=b;for(var i=this.element.value.toLowerCase(),j=c.Autocompleter.Search.LIST_ITEM_FIELD_SEP,k=0,l=h.length;!g&&l>k;++k)h[k]=h[k].join(j),h[k].toLowerCase()===i&&(g=!0,f.hide(),this.observer&&clearTimeout(this.observer),this.acceptSuggestion(k));g||(e=h,f.showSuggestions(h,this.element))}else f.showNotFoundMsg(this.element);g||c.Autocompleter.Event.notifyObservers(this.element,"SUGGESTIONS",{suggestion_list:e})}},acceptSuggestion:function(a){var b=this.suggestionList_[0],d=this.suggestionList_[1],e=this.element.value;this.element.value=d[a],this.setMatchStatusIndicator(!0),this.uneditedValue=this.element.value,this.fieldValIsListVal_=!0,this.propagateFieldChanges(),c.Autocompleter.Event.notifyObservers(this.element,"SUGGESTION_USED",{suggestion_used:this.element.value}),this.itemCodes_=b,this.itemToDataIndex_={},this.itemToDataIndex_[d[a]]=a,this.listExtraData_=this.suggestionList_[2],this.listSelectionNotification(e,!0),this.element.focus()}};Object.extend(c.Autocompleter.Search.prototype,e),e=null}($,jQuery,Def),function(a,b,c){c.Autocompleter.Event={observeListExpansions:function(a,b){this.storeCallback(a,"LIST_EXP",b)},observeListSelections:function(a,b){this.storeCallback(a,"LIST_SEL",b)},observeFocusEvents:function(a,b){this.storeCallback(a,"FOCUS",b)},observeCancelList:function(a,b){this.storeCallback(a,"CANCEL",b)},observeSuggestionsShown:function(a,b){this.storeCallback(a,"SUGGESTIONS",b)},observeSuggestionUsed:function(a,b){this.storeCallback(a,"SUGGESTION_USED",b)},observeListAssignments:function(a,b){this.storeCallback(a,"LIST_ASSIGNMENT",b)},observeRDRClearing:function(a){this.storeCallback(null,"RDR_CLEARING",a)},observeRDRAssignment:function(a){this.storeCallback(null,"RDR_ASSIGNMENT",a)}},Object.extend(c.Autocompleter.Event,c.Observable)}($,jQuery,Def),"undefined"!=typeof angular&&angular.module("autocompPhr",[]).directive("phrAutocomplete",["$timeout",function(){"use strict";return{require:"?ngModel",scope:{modelData:"=ngModel"},link:function(a,b,c,d){function e(b,c){for(var e,f=[],g={},h=0,i=c.source.length;i>h;++h){var j=c.source[h];e=j.text,f[h]=e,g[e]=j}var k=new Def.Autocompleter.Prefetch(b.id,f,c);return Def.Autocompleter.Event.observeListSelections(b.name,function(b){a.$apply(function(){if(k.multiSelect_){"object"!=typeof a.modelData&&(a.modelData=[]);var c=a.modelData;if(b.removed){for(var d=b.final_val,e=0,f=c.length;f>e;++e)if(d===c[e].text){c.splice(e,1);break}}else c.push(g[b.final_val])}else{var h=b.final_val,i=g[h]||{text:h};a.modelData=i}})}),d.$parsers.push(function(){var b=a.modelData;return void 0===b&&c.matchListValue!==!0&&(b=null),b}),void 0===c.defaultValue||void 0!==a.modelData&&null!==a.modelData||(a.modelData=g[c.defaultValue]),k}function f(a,b){return angular.extend({text:b,code:a.getItemCode(b)},a.getItemExtraData())}function g(b,c){var e=new Def.Autocompleter.Search(b.id,c.url,c);return Def.Autocompleter.Event.observeListSelections(b.name,function(b){a.$apply(function(){var c;if(e.multiSelect_){"object"!=typeof a.modelData&&(a.modelData=[]);var d=a.modelData;if(b.removed){for(var g=b.final_val,h=0,i=d.length;i>h;++h)if(g===d[h].text){d.splice(h,1);break}}else d.push(f(e,c))}else c=b.final_val,a.modelData=f(e,c)})}),d.$parsers.push(function(a){var b=a;if("string"==typeof a){var d=e.getItemCode(a);b=null===d&&c.matchListValue===!0?void 0:{text:a,code:d}}return b}),e}var h=function(){var f=a.$parent.$eval(c.phrAutocomplete);if(d){var h=b[0];""===h.id&&(Def.Autocompleter.lastGeneratedID_||(Def.Autocompleter.lastGeneratedID_=0),h.id="ac"+ ++Def.Autocompleter.lastGeneratedID_),""===h.name&&(h.name=h.id);var i=f.url?g(h,f):e(h,f);d.$formatters.push(function(a){var b=a;return i.multiSelect_?b="":"object"==typeof a&&(b=a.text),b})}};a.$watch({},h,!0)}}}]);